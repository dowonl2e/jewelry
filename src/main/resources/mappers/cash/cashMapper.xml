<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jewelry.cash.mapper.CashMapper">

	<sql id="cash-search">
		<if test='searchstore != null and !searchstore.equals("")'>
			AND a.store_cd = #{searchstore}
		</if>
		<if test='searchcashtype != null and !searchcashtype.equals("")'>
			AND a.cash_type_cd = #{searchcashtype}
		</if>
		<if test='searchbankbook != null and !searchbankbook.equals("")'>
			AND a.bankbook_cd = #{searchbankbook}
		</if>
		<if test='searchcashtype2 != null and !searchcashtype2.equals("")'>
			AND a.cash_type_cd2 = #{searchcashtype2}
		</if>
		<if test='searchmaterial != null and !searchmaterial.equals("")'>
			AND a.material_cd = #{searchmaterial}
		</if>
		<if test='searchstdt != null and !searchstdt.equals("")'>
			AND DATE_FORMAT(a.reg_dt, '%Y-%m-%d') <![CDATA[ >= ]]> STR_TO_DATE(#{searchstdt}, '%Y-%m-%d')
		</if>
		<if test='searcheddt != null and !searcheddt.equals("")'>
			AND DATE_FORMAT(a.reg_dt, '%Y-%m-%d') <![CDATA[ <= ]]> STR_TO_DATE(#{searcheddt}, '%Y-%m-%d')
		</if>
		<!-- 검색 키워드가 있을 때 -->
		<if test='searchword != null and !searchword.equals("")'>
			AND (
		    a.vender_nm LIKE CONCAT('%', #{searchword}, '%')
				OR a.history_desc LIKE CONCAT('%', #{searchword}, '%')
			)
		</if>
	</sql>
	
	<select id="selectCashListCount" parameterType="CashTO" resultType="Integer">
		SELECT COUNT(a.cash_no)
		FROM tb_cash a
		WHERE a.del_yn = 'N'
		<include refid="cash-search" />
	</select>
	
	<select id="selectCashList" parameterType="CashTO" resultType="CashVO">
		SELECT a.cash_no, a.reg_dt, a.store_cd, a.cash_type_cd, a.cash_type_cd2, a.bankbook_cd, a.vender_nm
						, a.history_desc, a.material_cd, a.weight_gram, a.quantity, a.unit_price
						, CASE DAYOFWEEK(DATE_FORMAT(a.reg_dt, '%Y%m%d'))
				       	WHEN '1' THEN '일'
				       	WHEN '2' THEN '월'
				       	WHEN '3' THEN '화'
				       	WHEN '4' THEN '수'
				       	WHEN '5' THEN '목'
				       	WHEN '6' THEN '금'
				       	WHEN '7' THEN '토'
			       	END AS reg_day
		FROM tb_cash a
		WHERE a.del_yn = 'N'
		<include refid="cash-search" />
		ORDER BY a.reg_dt DESC, a.cash_no DESC
		<include refid="commonMapper.paging" />
	</select>
	
</mapper>